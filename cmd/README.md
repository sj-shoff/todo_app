# todo_app

### Работа с докером:
```bash
docker run --name=todo-db -e POSTGRES_PASSWORD='03032006' -p 5436:5432 -d --rm postgres
docker ps
```

### Миграции - а-ля система контроля версий для баз данных
```bash
import "github.com/golang-migrate/migrate/v4" 
mkdir -p ./schema
migrate create -ext sql -dir ./schema -seq init
```

### Применение миграций:
```bash
migrate -path ./schema -database 'postgres://postgres:03032006@localhost:5436/postgres?sslmode=disable' up
```

### Проверка БД в контейнере(1я строка - берем айдишник postgres)
```bash
docker ps
docker exec -it 6188ec4b2fdd /bin/bash
psql -U postgres
\d
```
### Swagger
```bash
swag init -g cmd/main.go
```
### Чтобы посмотреть документацию Swagger: http://localhost:8000/swagger/index.html

###Скрипт wait-for-postgres.sh гарантирует, что приложение запустится только после готовности базы данных.

#!/bin/sh — указывает, что скрипт должен выполняться с помощью shell.

set -e — завершает выполнение скрипта, если любая команда завершится с ошибкой (ненулевым кодом возврата). Это помогает избежать продолжения выполнения скрипта, если что-то пошло не так.

host="$1" — первый аргумент скрипта (например, db или localhost), который передается в скрипт. Это хост базы данных.

shift — удаляет первый аргумент ($1) из списка аргументов, чтобы оставшиеся аргументы можно было использовать как команду для выполнения.

cmd="$@" — сохраняет все оставшиеся аргументы в переменную cmd. Это команда, которая будет выполнена после того, как база данных станет доступной.
until ... do ... done — цикл, который выполняется до тех пор, пока команда внутри until не завершится успешно (с кодом возврата 0).

PGPASSWORD=$DB_PASSWORD — передает пароль от базы данных в переменной окружения DB_PASSWORD в команду psql.

psql -h "$host" -U "postgres" -c '\q' — пытается подключиться к PostgreSQL:

-h "$host" — указывает хост базы данных.

-U "postgres" — указывает пользователя базы данных (в данном случае postgres).

-c '\q' — выполняет команду \q, которая просто завершает сеанс psql. Если подключение успешно, команда завершится с кодом 0.

Если подключение не удается, скрипт выводит сообщение Postgres is unavailable - sleeping и ждет 1 секунду (sleep 1), после чего повторяет попытку.

>&2 echo "Postgres is up - executing command" — выводит сообщение в стандартный поток ошибок (stderr), что база данных доступна.

exec $cmd — выполняет команду, переданную в скрипт (например, запуск приложения). exec заменяет текущий процесс (скрипт) на процесс команды, что позволяет корректно передавать сигналы (например, SIGTERM) от Docker к приложению.